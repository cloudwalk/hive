#!/bin/bash

set -e

echo $1
port=8545

echo "DEPLOYING CONTRACTS"
echo '\n'
echo "DEPLOYING VAULT CONTRACT"
echo '\n'

# deploy vault contract
# old hive addr: 0000000000000000000000000000000000000315
# new addr: 0x5FbDB2315678afecb367f032d93F642f64180aa3
# from 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
# nonce: 0
##contract creation code:
## 0x608060405234801561001057600080fd5b5061021d806100206000396000f3fe6080604052600436106100225760003560e01c8063ef2769ca1461002e57610029565b3661002957005b600080fd5b34801561003a57600080fd5b506100556004803603810190610050919061017d565b610057565b005b8173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050156100e0578173ffffffffffffffffffffffffffffffffffffffff167f30a3c50752f2552dcc2b93f5b96866280816a986c0c0408cb6778b9fa198288f826040516100d791906101cc565b60405180910390a25b5050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610114826100e9565b9050919050565b61012481610109565b811461012f57600080fd5b50565b6000813590506101418161011b565b92915050565b6000819050919050565b61015a81610147565b811461016557600080fd5b50565b60008135905061017781610151565b92915050565b60008060408385031215610194576101936100e4565b5b60006101a285828601610132565b92505060206101b385828601610168565b9150509250929050565b6101c681610147565b82525050565b60006020820190506101e160008301846101bd565b9291505056fea2646970667358221220c672a330ff60ded50b6205c57c8b6de997b503783ecd74f1af8aea3a7498d8a264736f6c63430008100033
## deployed  bytecode
##0x6080604052600436106100225760003560e01c8063ef2769ca1461002e57610029565b3661002957005b600080fd5b34801561003a57600080fd5b506100556004803603810190610050919061017d565b610057565b005b8173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050156100e0578173ffffffffffffffffffffffffffffffffffffffff167f30a3c50752f2552dcc2b93f5b96866280816a986c0c0408cb6778b9fa198288f826040516100d791906101cc565b60405180910390a25b5050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610114826100e9565b9050919050565b61012481610109565b811461012f57600080fd5b50565b6000813590506101418161011b565b92915050565b6000819050919050565b61015a81610147565b811461016557600080fd5b50565b60008135905061017781610151565b92915050565b60008060408385031215610194576101936100e4565b5b60006101a285828601610132565b92505060206101b385828601610168565b9150509250929050565b6101c681610147565b82525050565b60006020820190506101e160008301846101bd565b9291505056fea2646970667358221220c672a330ff60ded50b6205c57c8b6de997b503783ecd74f1af8aea3a7498d8a264736f6c63430008100033000000000000000000000000000000000000000000000000000000000000000000

curl http://$1:$port \
  -X POST \
  -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0xf9028b8080830f42408080b9023d608060405234801561001057600080fd5b5061021d806100206000396000f3fe6080604052600436106100225760003560e01c8063ef2769ca1461002e57610029565b3661002957005b600080fd5b34801561003a57600080fd5b506100556004803603810190610050919061017d565b610057565b005b8173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050156100e0578173ffffffffffffffffffffffffffffffffffffffff167f30a3c50752f2552dcc2b93f5b96866280816a986c0c0408cb6778b9fa198288f826040516100d791906101cc565b60405180910390a25b5050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610114826100e9565b9050919050565b61012481610109565b811461012f57600080fd5b50565b6000813590506101418161011b565b92915050565b6000819050919050565b61015a81610147565b811461016557600080fd5b50565b60008135905061017781610151565b92915050565b60008060408385031215610194576101936100e4565b5b60006101a285828601610132565b92505060206101b385828601610168565b9150509250929050565b6101c681610147565b82525050565b60006020820190506101e160008301846101bd565b9291505056fea2646970667358221220c672a330ff60ded50b6205c57c8b6de997b503783ecd74f1af8aea3a7498d8a264736f6c6343000810003332a08494833915bfa7c5899974f2413112b901f371e8fbc1acfdd300967c467777d1a027ba43c1e4a71d99441d4ce51c0848eb62941ec9061ae0ae745455ef6f3b6d28"],"id":1}'

echo '\n'
echo "DEPLOYING TEST CONTRACT\n"
echo '\n'
#deploy test contract
# old hive addr: 0000000000000000000000000000000000000314
# new addr: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
# from 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
# nonce: 1
#contract creation code:
# 0x608060405234801561001057600080fd5b506040516106b43803806106b4833981810160405281019061003291906100be565b8060008190555080600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550506100eb565b600080fd5b6000819050919050565b61009b81610088565b81146100a657600080fd5b50565b6000815190506100b881610092565b92915050565b6000602082840312156100d4576100d3610083565b5b60006100e2848285016100a9565b91505092915050565b6105ba806100fa6000396000f3fe60806040526004361061005e5760003560e01c8063abfced1d11610043578063abfced1d146100d2578063e05c914a146100fb578063e6768b451461012457610065565b8063a223e05d1461006a578063abd1a0cf1461009557610065565b3661006557005b600080fd5b34801561007657600080fd5b5061007f610163565b60405161008c9190610350565b60405180910390f35b3480156100a157600080fd5b506100bc60048036038101906100b791906103ce565b610169565b6040516100c99190610350565b60405180910390f35b3480156100de57600080fd5b506100f960048036038101906100f49190610427565b6101b2565b005b34801561010757600080fd5b50610122600480360381019061011d9190610467565b6101fa565b005b34801561013057600080fd5b5061014b600480360381019061014691906104a7565b610320565b60405161015a939291906104fa565b60405180910390f35b60005481565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505050565b7f6031a8d62d7c95988fa262657cd92107d90ed96e08d8f867d32f26edfe85502260405160405180910390a17f47e2689743f14e97f7dcfa5eec10ba1dff02f83b3d1d4b9c07b206cbbda66450826040516102559190610350565b60405180910390a1817fa48a6b249a5084126c3da369fbc9b16827ead8cb5cdc094b717d3f1dcd995e2960405160405180910390a27f7890603b316f3509577afd111710f9ebeefa15e12f72347d9dffd0d65ae3bade816040516102b99190610540565b60405180910390a18073ffffffffffffffffffffffffffffffffffffffff167f7efef9ea3f60ddc038e50cccec621f86a0195894dc0520482abf8b5c6b659e4160405160405180910390a2818160405161031492919061055b565b60405180910390a05050565b600080600085858592509250925093509350939050565b6000819050919050565b61034a81610337565b82525050565b60006020820190506103656000830184610341565b92915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061039b82610370565b9050919050565b6103ab81610390565b81146103b657600080fd5b50565b6000813590506103c8816103a2565b92915050565b6000602082840312156103e4576103e361036b565b5b60006103f2848285016103b9565b91505092915050565b61040481610337565b811461040f57600080fd5b50565b600081359050610421816103fb565b92915050565b6000806040838503121561043e5761043d61036b565b5b600061044c858286016103b9565b925050602061045d85828601610412565b9150509250929050565b6000806040838503121561047e5761047d61036b565b5b600061048c85828601610412565b925050602061049d858286016103b9565b9150509250929050565b6000806000606084860312156104c0576104bf61036b565b5b60006104ce86828701610412565b93505060206104df86828701610412565b92505060406104f086828701610412565b9150509250925092565b600060608201905061050f6000830186610341565b61051c6020830185610341565b6105296040830184610341565b949350505050565b61053a81610390565b82525050565b60006020820190506105556000830184610531565b92915050565b60006040820190506105706000830185610341565b61057d6020830184610531565b939250505056fea2646970667358221220de5c90f8aa63d90e946f8702fd31aa225f69db1e4987cc52db2b0c7f26edb61e64736f6c6343000810003300000000000000000000000000000000000000000000000000000000000004d2
#deployed bytecode:
#0x60806040526004361061005e5760003560e01c8063abfced1d11610043578063abfced1d146100d2578063e05c914a146100fb578063e6768b451461012457610065565b8063a223e05d1461006a578063abd1a0cf1461009557610065565b3661006557005b600080fd5b34801561007657600080fd5b5061007f610163565b60405161008c9190610350565b60405180910390f35b3480156100a157600080fd5b506100bc60048036038101906100b791906103ce565b610169565b6040516100c99190610350565b60405180910390f35b3480156100de57600080fd5b506100f960048036038101906100f49190610427565b6101b2565b005b34801561010757600080fd5b50610122600480360381019061011d9190610467565b6101fa565b005b34801561013057600080fd5b5061014b600480360381019061014691906104a7565b610320565b60405161015a939291906104fa565b60405180910390f35b60005481565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505050565b7f6031a8d62d7c95988fa262657cd92107d90ed96e08d8f867d32f26edfe85502260405160405180910390a17f47e2689743f14e97f7dcfa5eec10ba1dff02f83b3d1d4b9c07b206cbbda66450826040516102559190610350565b60405180910390a1817fa48a6b249a5084126c3da369fbc9b16827ead8cb5cdc094b717d3f1dcd995e2960405160405180910390a27f7890603b316f3509577afd111710f9ebeefa15e12f72347d9dffd0d65ae3bade816040516102b99190610540565b60405180910390a18073ffffffffffffffffffffffffffffffffffffffff167f7efef9ea3f60ddc038e50cccec621f86a0195894dc0520482abf8b5c6b659e4160405160405180910390a2818160405161031492919061055b565b60405180910390a05050565b600080600085858592509250925093509350939050565b6000819050919050565b61034a81610337565b82525050565b60006020820190506103656000830184610341565b92915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061039b82610370565b9050919050565b6103ab81610390565b81146103b657600080fd5b50565b6000813590506103c8816103a2565b92915050565b6000602082840312156103e4576103e361036b565b5b60006103f2848285016103b9565b91505092915050565b61040481610337565b811461040f57600080fd5b50565b600081359050610421816103fb565b92915050565b6000806040838503121561043e5761043d61036b565b5b600061044c858286016103b9565b925050602061045d85828601610412565b9150509250929050565b6000806040838503121561047e5761047d61036b565b5b600061048c85828601610412565b925050602061049d858286016103b9565b9150509250929050565b6000806000606084860312156104c0576104bf61036b565b5b60006104ce86828701610412565b93505060206104df86828701610412565b92505060406104f086828701610412565b9150509250925092565b600060608201905061050f6000830186610341565b61051c6020830185610341565b6105296040830184610341565b949350505050565b61053a81610390565b82525050565b60006020820190506105556000830184610531565b92915050565b60006040820190506105706000830185610341565b61057d6020830184610531565b939250505056fea2646970667358221220de5c90f8aa63d90e946f8702fd31aa225f69db1e4987cc52db2b0c7f26edb61e64736f6c63430008100033000000000000000000000000000000000000000000000000000000000000000000
curl http://$1:$port \
  -X POST \
  -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0xf907220180830f42408080b906d4608060405234801561001057600080fd5b506040516106b43803806106b4833981810160405281019061003291906100be565b8060008190555080600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550506100eb565b600080fd5b6000819050919050565b61009b81610088565b81146100a657600080fd5b50565b6000815190506100b881610092565b92915050565b6000602082840312156100d4576100d3610083565b5b60006100e2848285016100a9565b91505092915050565b6105ba806100fa6000396000f3fe60806040526004361061005e5760003560e01c8063abfced1d11610043578063abfced1d146100d2578063e05c914a146100fb578063e6768b451461012457610065565b8063a223e05d1461006a578063abd1a0cf1461009557610065565b3661006557005b600080fd5b34801561007657600080fd5b5061007f610163565b60405161008c9190610350565b60405180910390f35b3480156100a157600080fd5b506100bc60048036038101906100b791906103ce565b610169565b6040516100c99190610350565b60405180910390f35b3480156100de57600080fd5b506100f960048036038101906100f49190610427565b6101b2565b005b34801561010757600080fd5b50610122600480360381019061011d9190610467565b6101fa565b005b34801561013057600080fd5b5061014b600480360381019061014691906104a7565b610320565b60405161015a939291906104fa565b60405180910390f35b60005481565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505050565b7f6031a8d62d7c95988fa262657cd92107d90ed96e08d8f867d32f26edfe85502260405160405180910390a17f47e2689743f14e97f7dcfa5eec10ba1dff02f83b3d1d4b9c07b206cbbda66450826040516102559190610350565b60405180910390a1817fa48a6b249a5084126c3da369fbc9b16827ead8cb5cdc094b717d3f1dcd995e2960405160405180910390a27f7890603b316f3509577afd111710f9ebeefa15e12f72347d9dffd0d65ae3bade816040516102b99190610540565b60405180910390a18073ffffffffffffffffffffffffffffffffffffffff167f7efef9ea3f60ddc038e50cccec621f86a0195894dc0520482abf8b5c6b659e4160405160405180910390a2818160405161031492919061055b565b60405180910390a05050565b600080600085858592509250925093509350939050565b6000819050919050565b61034a81610337565b82525050565b60006020820190506103656000830184610341565b92915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061039b82610370565b9050919050565b6103ab81610390565b81146103b657600080fd5b50565b6000813590506103c8816103a2565b92915050565b6000602082840312156103e4576103e361036b565b5b60006103f2848285016103b9565b91505092915050565b61040481610337565b811461040f57600080fd5b50565b600081359050610421816103fb565b92915050565b6000806040838503121561043e5761043d61036b565b5b600061044c858286016103b9565b925050602061045d85828601610412565b9150509250929050565b6000806040838503121561047e5761047d61036b565b5b600061048c85828601610412565b925050602061049d858286016103b9565b9150509250929050565b6000806000606084860312156104c0576104bf61036b565b5b60006104ce86828701610412565b93505060206104df86828701610412565b92505060406104f086828701610412565b9150509250925092565b600060608201905061050f6000830186610341565b61051c6020830185610341565b6105296040830184610341565b949350505050565b61053a81610390565b82525050565b60006020820190506105556000830184610531565b92915050565b60006040820190506105706000830185610341565b61057d6020830184610531565b939250505056fea2646970667358221220de5c90f8aa63d90e946f8702fd31aa225f69db1e4987cc52db2b0c7f26edb61e64736f6c6343000810003300000000000000000000000000000000000000000000000000000000000004d232a0c0a79d6cb580a8e2b45de7834e755d002b187fbeaa13e98e837c1a64d301a385a02cf7ede1e8d81865c099eebe9f06bd3f6ee75237650d6df2deb3d18abbc425e5"],"id":1}'

echo '\n'
echo "FUND VAULT"
echo '\n'
#send funds to vault contract
# funds: BigInt(18446744073709000000)
curl http://$1:$port \
  -X POST \
  -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0xf8680280830f4240945fbdb2315678afecb367f032d93f642f64180aa388fffffffffff798008032a0947643d69eaa3180faed490d64288c64d023a26dd4e90fdc3e1631def5a958a6a02f86fcaaa63be3cf9906bc28b8e0c24a1bc363599d82de9e8d28e532f382f180"],"id":1}'
echo '\n'

echo '\n'
echo "Call addToMap in Test Contract to add data to map for hive test"
echo '\n'
#send funds to vault contract
curl http://$1:$port \
  -X POST \
  -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0xf8a50380830f424094e7f1725e7734ce288f8367e1bb143e90bb3f051280b844abfced1d000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266000000000000000000000000000000000000000000000000000000000000000131a0bb7a118bdd92088e14f7a54d3c9506da29140b622498ebba5b89bc9bc0660480a0095ededf12d55b1e52dc5d87848c9699ef243acd120dac6600bddc3eff88a330"],"id":1}'
echo '\n'
